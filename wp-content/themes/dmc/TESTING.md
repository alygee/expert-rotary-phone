# Инструкция по тестированию функции filterData2

## Способы тестирования

### 1. Простой тестовый скрипт (рекомендуется для быстрой проверки)

**Файл:** `test_filterData2.php`

**Запуск через командную строку:**
```bash
cd wp-content/themes/dmc
php test_filterData2.php
```

**Запуск через браузер:**
```
http://your-site.com/wp-content/themes/dmc/test_filterData2.php
```

**Что делает:**
- Создает мок-данные, имитирующие структуру CSV
- Запускает 12 различных тестовых сценариев
- Выводит подробные результаты каждого теста
- Использует `assert()` для проверки результатов

**Преимущества:**
- Не требует дополнительных зависимостей
- Легко запускается
- Показывает детальные результаты

---

### 2. Unit-тесты с PHPUnit (для профессионального тестирования)

**Файл:** `tests/FilterData2Test.php`

**Установка PHPUnit:**
```bash
cd wp-content/themes/dmc
composer init
composer require --dev phpunit/phpunit
```

**Создание phpunit.xml:**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<phpunit bootstrap="vendor/autoload.php">
    <testsuites>
        <testsuite name="FilterData2 Tests">
            <file>tests/FilterData2Test.php</file>
        </testsuite>
    </testsuites>
</phpunit>
```

**Запуск тестов:**
```bash
vendor/bin/phpunit tests/FilterData2Test.php
# или
vendor/bin/phpunit
```

**Преимущества:**
- Стандартный подход к тестированию
- Интеграция с CI/CD
- Детальные отчеты
- Возможность покрытия кода

---

## Тестовые сценарии

### Базовые тесты:
1. ✅ Фильтрация по одному городу
2. ✅ Фильтрация по нескольким городам
3. ✅ Фильтрация по уровню
4. ✅ Фильтрация по количеству сотрудников
5. ✅ Комбинированная фильтрация (город + уровень + количество)

### Продвинутые тесты:
6. ✅ Fallback на "Другой город" при отсутствии результатов
7. ✅ Город как строка (не массив)
8. ✅ Без фильтров (все данные)
9. ✅ Сохранение порядка городов
10. ✅ Обрезка пробелов в параметрах
11. ✅ Игнорирование пустых строк
12. ✅ Количество сотрудников вне диапазона

---

## Структура тестовых данных

Функция ожидает массив с записями следующей структуры:

```php
[
    [
        'Город' => 'Москва',
        'Уровень' => 'Стандарт',
        'Кол-во_сотрудников' => '1-10',  // формат: "min-max"
        'Страховщик' => 'Сбербанк страхование',
        'Стоматология' => '5000',
        'Скорая_помощь' => '3000',
        'Госпитализация' => '10000',
        'Вызов_врача_на_дом' => '2000',
        'Поликлиника' => '15000'
    ],
    // ... другие записи
]
```

---

## Что проверяют тесты

### ✅ Корректность фильтрации:
- Фильтрация по городам работает правильно
- Фильтрация по уровням работает правильно
- Фильтрация по количеству сотрудников работает правильно
- Комбинированная фильтрация работает правильно

### ✅ Обработка граничных случаев:
- Несуществующие города → fallback на "Другой город"
- Пустые параметры → возврат всех данных
- Пробелы в параметрах → автоматическая обрезка
- Пустые строки → игнорирование

### ✅ Структура результата:
- Результат группируется по городам
- Порядок городов сохраняется
- Структура данных корректна

---

## Добавление новых тестов

### В простой скрипт (test_filterData2.php):

```php
// Добавьте новый тест в конец файла
$result = filterData2($mockData, ['НовыйГород'], ['НовыйУровень']);
printTestResult("Тест N: Описание теста", $result);
assert(/* условие проверки */, "Сообщение об ошибке");
```

### В PHPUnit (tests/FilterData2Test.php):

```php
public function testNewScenario()
{
    $result = filterData2($this->mockData, ['НовыйГород']);
    
    $this->assertArrayHasKey('НовыйГород', $result);
    // другие проверки
}
```

---

## Отладка

Если тесты не проходят:

1. **Проверьте структуру данных:**
   - Убедитесь, что ключи массива совпадают ('Город', 'Уровень', 'Кол-во_сотрудников')
   - Проверьте формат 'Кол-во_сотрудников' (должен быть "min-max")

2. **Проверьте кодировку:**
   - Убедитесь, что используется UTF-8
   - Проверьте русские символы в данных

3. **Включите отладку:**
   ```php
   error_reporting(E_ALL);
   ini_set('display_errors', 1);
   ```

4. **Используйте var_dump:**
   ```php
   var_dump($result);
   ```

---

## Интеграция с реальными данными

Для тестирования с реальными данными из CSV:

```php
// В test_filterData2.php замените $mockData на:
require_once('../../../wp-load.php');
$realData = rez(); // функция из functions.php
$result = filterData2($realData, ['Москва'], ['Комфорт'], 12);
```

---

## Полезные команды

```bash
# Запуск простого теста
php test_filterData2.php

# Запуск PHPUnit тестов
vendor/bin/phpunit tests/FilterData2Test.php

# Запуск с подробным выводом
vendor/bin/phpunit --verbose tests/FilterData2Test.php

# Запуск конкретного теста
vendor/bin/phpunit --filter testFilterBySingleCity
```

